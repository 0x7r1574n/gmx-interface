import { createPublicClient, http } from "viem";
import { arbitrum } from "viem/chains";
import { describe, expect, it } from "vitest";

import { estimateArbitrumL1Gas } from "./estimate";

describe("estimateArbitrumL1Gas", () => {
  const client = createPublicClient({
    chain: arbitrum,
    transport: http(),
  });

  it("should estimate the L1 gas correctly", async () => {
    const to = "0x5Df3a1cEbBD9c8BA7F8dF51Fd632A9aef8308897";
    const data =
      "0x7cd44734000000000000000000000000543bda7c6ca4384fe90b1f5929bb851f52888983000000000000000000000000a132826c0d28f6626534b1ca6fd7b2c32dd289e53a01e67d76e152ba86876744b28644094a245867b07958f412511e2dced7f27b000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000e000000000000000000000000000000000000000000000000000000000000001a0000000000000000000000000000000000000000000000000000000000002da17000000000000000000000000000000000000000000000000000000000000008c00000000000000e100009d280000000000000000000000000000000000000000000000000000000001312d00000000000000000000000000414da6c7c50eadfbd4c67c902c7daf59f58d32c7000000000000000000000000414da6c7c50eadfbd4c67c902c7daf59f58d32c70000000000000000000000000000000000000000000000000000000000aa37dc00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000";

    const l1Gas = await estimateArbitrumL1Gas(client, to, data, {
      blockNumber: 324927725n,
    });

    expect(l1Gas).toBe(60278n);
  });
});
